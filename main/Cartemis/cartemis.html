<head>
<style>
      #map {
        height: 400px;
        width: 400px;
      }
      
      #select {}
      
      #webcam{}
      #canvas{}
</style>

<script>
   var compassLink;
  var direction = 0;
  var gamma = 0;
  var altitude = 0;
  var longitude = 0;
  var latitude = 0;
  var tlongitude = 0;
  var tlatitude = 0;
  var distance = 100;
  var angle = 0;
  var newData;

  var zoom = 16;
  var defaultAltitude = 15;

  var map;
  var marker;
  var lineSymbol;
  var line;

  window.initMap = function initMap() {
    compassLink=document.getElementById('compass');
    map = new google.maps.Map(document.getElementById('map'), {
      center: {
        lat: latitude,
        lng: longitude
      },
      zoom: zoom
    });

    lineSymbol = {
      path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
    };
    initCompass();
    getLocation();
  }

  function updateArrow() {
    if (line != undefined) {
      line.setMap(null);
    }
    line = new google.maps.Polyline({
      path: [{
        lat: latitude,
        lng: longitude
      }, {
        lat: tlatitude,
        lng: tlongitude
      }],
      icons: [{
        icon: lineSymbol,
        offset: '100%'
      }],
      map: map
    });
  }

  function updateMarker() {
    if (marker != undefined) {
      marker.setMap(null);
    }
    if (google != undefined) {
$.get("http://php-robertclaus.rhcloud.com/test3.php?query=SELECT%20*%20FROM%20cartemis",
function(data){
console.log(data);
newData=JSON.parse(data);
console.log(newData[2]);
	var newMarker = new google.maps.Marker({
        position: {
          lat: parseFloat(newData[3]),
          lng: parseFloat(newData[2])
        },
        map: map,
        title: "B"
	});
});



      marker = new google.maps.Marker({
        position: {
          lat: latitude,
          lng: longitude
        },
        map: map,
        title: "A"
      });
    }
    updateArrow();
  }

  function updateText() {
    compassLink.innerHTML =
      "Direction: " + direction +
      "<br />Distance: " + distance +
      "<br />tLongitude: " + tlongitude +
      "<br />tLatitude: " + tlatitude +
      "<br />Angle: " + gamma +
      "<br />Longitute: " + latitude +
      "<br />Latitude: " + latitude +
      "<br />Altitude: " + altitude;
  }

  function calcTarget() {
    if (gamma != 0 && latitude != 0 && longitude != 0 && direction != 0) {
      var gammaInRadians = gamma * Math.PI / 180;
      var latitudeInRadians = latitude * Math.PI / 180;
      var longitudeInRadians = longitude * Math.PI / 180;
      var directionInRadians = direction * Math.PI / 180;

      distance = altitude * Math.tan(gammaInRadians);
      var angularDistance = distance / 6371000;

      var tlatitudeInRadians = Math.asin(Math.sin(latitudeInRadians) * Math.cos(angularDistance) + Math.cos(latitudeInRadians) * Math.sin(angularDistance) * Math.cos(directionInRadians));
      var tlongitudeInRadians = longitudeInRadians + Math.atan2(Math.sin(directionInRadians) * Math.sin(angularDistance) * Math.cos(latitudeInRadians),
        Math.cos(angularDistance) - Math.sin(latitudeInRadians) * Math.sin(tlatitude));
      tlatitude = 180 * tlatitudeInRadians / Math.PI;
      tlongitude = 180 * tlongitudeInRadians / Math.PI;
    }
  }

  function updateDisplay() {

    updateText();
    if (google != undefined) {
      updateMarker();
    }
  }

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(showPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }

  function showPosition(position) {
    latitude = position.coords.latitude;
    longitude = position.coords.longitude;
    altitude = position.coords.altitude;
    if (altitude == null) {
      altitude = defaultAltitude;
    }
    var pos = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };
    if (map != undefined) {
      map.setCenter(pos);
      updateDisplay();
    }
  }


  function initCompass() {
    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', function(event) {
        var alpha;
        var showingNoData = true;
        if (event.webkitCompassHeading) {
          alpha = event.webkitCompassHeading;
        } else {
          alpha = event.alpha;
          gamma = event.gamma;
          webkitAlpha = alpha;
          if (!window.chrome) {
            webkitAlpha = alpha - 270;
          }
          if (gamma > 0) {
            alpha = alpha + 180;
          }
        }
        direction = alpha;
        calcTarget();
        updateDisplay();

      }, false);
    }
  }

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>

<body>
<div id="map">a</div>
<div id="compass">
  test
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCedWcOACn_NzxmfoZpWVkONGInbi6RQQc&callback=initMap" async defer></script>

</body>