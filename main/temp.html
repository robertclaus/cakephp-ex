<html>

	<div style="width:40%;float:left;padding-right:5%;">
	This temperature is collected by an Arduino Cactus rev2 connected to 6 temperature sensors.  It attempts to post data to a mySQL server every minute for each sensor.  Due to poor connectivity where it is placed at the moment, a good number of datapoints fail.  However, the overall trends are still obviously visible.  Future projects include recalibrating the sensors to catch vertical temperature differences since the individual sensor's errors currently dominate the trends.
	</div>
		
	<div id="test" style="height:100%; width:50%;float:left;">
	</div>

<script language="javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="http://www.pureexample.com/js/flot/excanvas.min.js"></script>
<script language="javascript" type="text/javascript" src="http://www.pureexample.com/js/flot/jquery.flot.min.js"></script>

<script>
var data = ["25.94","1395","2016-06-05 12:34:21","124","26.88","1411","2016-06-05 12:34:27","125","25.88","1427","2016-06-05 12:34:32","126","25.63","1443","2016-06-05 12:34:38","127","25.88","1395","2016-06-05 12:35:39","128","25.94","1411","2016-06-05 12:35:45","129","25.63","1427","2016-06-05 12:35:50","130","25.63","1443","2016-06-05 12:35:55","131","25.69","1395","2016-06-05 12:36:57","132","25.69","1411","2016-06-05 12:37:02","133","25.5","1427","2016-06-05 12:37:07","134","25.63","1443","2016-06-05 12:37:13","135","25.56","1395","2016-06-05 12:38:14","136","25.63","1411","2016-06-05 12:38:20","137","25.44","1427","2016-06-05 12:38:25","138","25.63","1435","2016-06-05 12:38:25","139","25.56","1443","2016-06-05 12:38:26","140","25.5","1395","2016-06-05 12:39:27","141","25.5","1411","2016-06-05 12:39:33","142","25.38","1427","2016-06-05 12:39:38","143","25.5","1443","2016-06-05 12:39:44","144","25.44","1395","2016-06-05 12:40:45","145","25.44","1411","2016-06-05 12:40:50","146","25.31","1427","2016-06-05 12:40:56","147","25.44","1443","2016-06-05 12:41:01","148","25.44","1395","2016-06-05 12:42:03","149","25.44","1411","2016-06-05 12:42:08","150","25.25","1419","2016-06-05 12:42:09","151","25.25","1427","2016-06-05 12:42:09","152","25.44","1443","2016-06-05 12:42:14","153","25.5","1395","2016-06-05 12:43:16","154","25.5","1411","2016-06-05 12:43:21","155","25.31","1427","2016-06-05 12:43:27","156","25.5","1443","2016-06-05 12:43:32","157","25.5","1395","2016-06-05 12:44:33","158","25.25","1403","2016-06-05 12:44:34","159","25.31","1419","2016-06-05 12:44:39","160","25.5","1435","2016-06-05 12:44:45","161","25.56","1395","2016-06-05 12:45:51","162","25.56","1411","2016-06-05 12:45:57","163","25.38","1427","2016-06-05 12:46:02","164","25.5","1443","2016-06-05 12:46:07","165","25.56","1395","2016-06-05 12:47:09","166","25.56","1411","2016-06-05 12:47:14","167","25.38","1419","2016-06-05 12:47:15","168","25.63","1435","2016-06-05 12:47:20","169","25.56","1395","2016-06-05 12:48:26","170","25.5","1411","2016-06-05 12:48:32","171","25.31","1427","2016-06-05 12:48:37","172","25.44","1443","2016-06-05 12:48:43","173","25.56","1395","2016-06-05 12:49:44","174","25.56","1411","2016-06-05 12:49:49","175","25.38","1427","2016-06-05 12:49:55","176","25.63","1435","2016-06-05 12:49:56","177","25.63","1395","2016-06-05 12:51:02","178","25.38","1403","2016-06-05 12:51:03","179","25.44","1419","2016-06-05 12:51:08","180","25.69","1435","2016-06-05 12:51:13","181","25.5","1443","2016-06-05 12:51:14","182","25.56","1395","2016-06-05 12:52:15","183","25.56","1411","2016-06-05 12:52:20","184","25.38","1427","2016-06-05 12:52:26","185","25.5","1443","2016-06-05 12:52:31","186","25.56","1395","2016-06-05 12:53:33","187","25.63","1411","2016-06-05 12:53:39","188","25.44","1427","2016-06-05 12:53:44","189","25.5","1443","2016-06-05 12:53:49","190","25.5","1395","2016-06-05 12:54:51","191","25.5","1411","2016-06-05 12:54:56","192","25.31","1427","2016-06-05 12:55:02","193","25.5","1443","2016-06-05 12:55:07","194","25.44","1395","2016-06-05 12:56:08","195","25.44","1411","2016-06-05 12:56:14","196","25.25","1427","2016-06-05 12:56:19","197","25.44","1443","2016-06-05 12:56:25","198","25.5","1395","2016-06-05 12:57:26","199","25.5","1411","2016-06-05 12:57:32","200","25.25","1427","2016-06-05 12:57:37","201","25.5","1443","2016-06-05 12:57:43","202","25.5","1395","2016-06-05 12:58:44","203","25.44","1411","2016-06-05 12:58:49","204","25.25","1427","2016-06-05 12:58:55","205","25.5","1443","2016-06-05 12:59:00","206","25.5","1395","2016-06-05 13:00:01","207","25.44","1411","2016-06-05 13:00:07","208","25.19","1427","2016-06-05 13:00:12","209","25.56","1435","2016-06-05 13:00:13","210"];


var formatted=[];
var params=[];
var plot;

var formatData = function formatData()
{
	formatted=[];
	params=[];
	for(var i=0;i<data.length;i=i+4)
	{
	var sensorId=parseInt(data[i+1]);
	var timeStamp = data[i+2]*1000-(6*60*60*1000);//new Date(data[i+2]).getTime()-(7*60*60*1000);
	//console.log(timeStamp);
	var value = data[i];

	if(!isNaN(sensorId) && sensorId!=-1)
	{
		if(sensorId<0)
		{
			sensorId = sensorId*-1;
		}

		if(formatted[sensorId]==null)
		{
		formatted[sensorId]=[];
		}
		formatted[sensorId].push([timeStamp,value]);
		}

	}
	
		//alert("start");
		for(var j=0;j<formatted.length;j++)
		{
			
			while(formatted[j] && formatted[j].length>10000)
			{
			var newformatted=[];
				for(var k=0;k<formatted[j].length-2;k=k+2)
				{
					newformatted.push([((formatted[j][k][0]+formatted[j][k+1][0])/2),((formatted[j][k][1]+formatted[j][k+1][1])/2)]);
				}
				formatted[j]=newformatted;
			}
			if(formatted[j])
			{
				params.push({
				data:formatted[j]
				});
			}
			
		}
		//alert("done formatting");
	//console.log(params);
}

$(document).ready(function(){
//formatData();
plot=$.plot($("#test"),[],{ 
               xaxis:  {
                      mode: "time", timeformat: "%m/%d/%y %h:%M", minTickSize: [1, "minute"],
					  timezone:"America/Chicago"
                }});

$.ajax({url: "http://php-robertclaus.rhcloud.com/test3.php?query=SELECT%20temp,%20device,%20UNIX_TIMESTAMP(time),%20id%20FROM%20Temperatures%20ORDER%20BY%20id%20DESC%20LIMIT%20100000",//"http://php-robertclaus.rhcloud.com/test3.php?query=SELECT%20temp,%20device,%20time,%20id%20FROM%20Temperatures%20ORDER%20BY%20id%20DESC%20LIMIT%201000",
success: function(result){
data=JSON.parse(result);
formatData();
plot.setData(params);
plot.setupGrid();
plot.draw();
//console.log(data);
}});
});
</script>

</html>