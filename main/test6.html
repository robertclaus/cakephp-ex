<script src= "http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/Chart.js-master/Chart.min.js"></script>
<!--<script src="http://jqueryrotate.googlecode.com/svn/trunk/jQueryRotate.js"></script>-->

<script>

var data = {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
        {
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: [65, 59, 80, 81, 56, 55, 40]
        },
        {
            label: "My Second dataset",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: [28, 48, 40, 19, 86, 27, 90]
        }
    ]
};

var options = {

    ///Boolean - Whether grid lines are shown across the chart
    scaleShowGridLines : true,

    //String - Colour of the grid lines
    scaleGridLineColor : "rgba(0,0,0,.05)",

    //Number - Width of the grid lines
    scaleGridLineWidth : 1,

    //Boolean - Whether to show horizontal lines (except X axis)
    scaleShowHorizontalLines: true,

    //Boolean - Whether to show vertical lines (except Y axis)
    scaleShowVerticalLines: true,

    //Boolean - Whether the line is curved between points
    bezierCurve : true,

    //Number - Tension of the bezier curve between points
    bezierCurveTension : 0.4,

    //Boolean - Whether to show a dot for each point
    pointDot : true,

    //Number - Radius of each point dot in pixels
    pointDotRadius : 4,

    //Number - Pixel width of point dot stroke
    pointDotStrokeWidth : 1,

    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
    pointHitDetectionRadius : 20,

    //Boolean - Whether to show a stroke for datasets
    datasetStroke : true,

    //Number - Pixel width of dataset stroke
    datasetStrokeWidth : 2,

    //Boolean - Whether to fill the dataset with a colour
    datasetFill : true,

    //String - A legend template
    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

};
window.onload = function()
{
		var rownum=0;
		var temps=new Array();
		var brights=new Array();
		var humidity=new Array();
		var dates= new Array();
		$.ajax({url:"test3.php?query=SELECT COUNT(id) FROM Logging WHERE DateTime > Date_Add(NOW(), INTERVAL -1 Day)",
			dataType:'json',
			success:function(result2){
			//alert(Math.ceil(result2[0]/20));
		$.ajax({url:"test3.php?query=SELECT * FROM Logging WHERE DateTime > Date_Add(NOW(), INTERVAL -1 Day) AND ID % "+Math.ceil(result2[0]/20)+"=0",
			dataType:'json',
			success:function(result){
			for (i = 0; i < result.length-5; i=i+5) {
				temps[rownum] = result[i+1];
				brights[rownum] = result[i+2]/10;
				dates[rownum] = result[i+3];
				humidity[rownum]=result[i+4];
				rownum=rownum+1;
			}

			dataTemp = {
    				labels: dates,
    				datasets: [
        				{
            				label: "Temperature",
            				fillColor: "rgba(220,220,220,0.2)",
            				strokeColor: "rgba(220,220,220,1)",
            				pointColor: "rgba(220,220,220,1)",
            				pointStrokeColor: "#fff",
            				pointHighlightFill: "#fff",
            				pointHighlightStroke: "rgba(220,220,220,1)",
            				data: temps
        				}
    				]
			};

			dataBright= {
    				labels: dates,
    				datasets: [
        				{
            				label: "Brightness",
            				fillColor: "rgba(151,187,205,0.2)",
            				strokeColor: "rgba(151,187,205,1)",
            				pointColor: "rgba(151,187,205,1)",
            				pointStrokeColor: "#fff",
            				pointHighlightFill: "#fff",
            				pointHighlightStroke: "rgba(151,187,205,1)",
            				data: brights
        				}
    				]
			};

			dataHumidity= {
    				labels: dates,
    				datasets: [
        				{
            				label: "Humidity",
            				fillColor: "rgba(151,187,205,0.2)",
            				strokeColor: "rgba(151,187,205,1)",
            				pointColor: "rgba(151,187,205,1)",
            				pointStrokeColor: "#fff",
            				pointHighlightFill: "#fff",
            				pointHighlightStroke: "rgba(151,187,205,1)",
            				data: humidity
        				}
    				]
			};



			var ctx1 = document.getElementById("myChartTemp").getContext("2d");
			new Chart(ctx1).Line(dataTemp, {
    				bezierCurve: false
			});

			var ctx2 = document.getElementById("myChartBright").getContext("2d");
			new Chart(ctx2).Line(dataBright, {
    				bezierCurve: false
			});

			var ctx2 = document.getElementById("myChartHumidity").getContext("2d");
			new Chart(ctx2).Line(dataHumidity, {
    				bezierCurve: false
			});


		  }});	 }});	
}


</script>

<body>
<div>
	<h1 style="float:left;width:450px;">Temperature (C)</h1>
	<h1 style="float:left;width:450px;">Brightness (%)</h1>
	<h1 style="float:left;">Humidity (%)</h1>
</div>
<div>
	<canvas id="myChartTemp" width="400px" height="400px"></canvas>
	<canvas id="myChartBright" width="400px" height="400px"></canvas>
	<canvas id="myChartHumidity" width="400px" height="400px"></canvas>

</div>
</body>

