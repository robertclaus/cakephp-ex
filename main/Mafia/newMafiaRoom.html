<script src= "http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<div id="list">
<table>
<thead>
<th>Title</th>
<th>Description</th>
<th>Count</th>
</thead>
<tbody id="entry">
</tbody>
</table>
</div>
<button onclick="newType('','',1);">Add Type</button>
<button onclick="createRoom();">Create</button>
<button onclick="window.location.href='MafiaMain.html'">Back</button>
<input type="number" id="room">

<script>
function findRoom()
{

	var query = "../test3.php?query=SELECT%20MAX(Room)%20FROM%20MafiaSimple";

	$.ajax({url:query,
			dataType:'json',
			success:function(result){
				console.log(result);
				$('#room').val(Number(result[0])+1);
			}
		  });

}

function createRoom()
{
	var query="../test3.php?query=INSERT INTO MafiaSimple (id, Title, Description, Assigned, Room) VALUES ";
	var firstComma=true;
	var room=$('#room').val();
	for(var i=0;i<$(".role").length;i++)
	{

		var Title=$($('.role')[i]).find('.title')[0].value;
		var Desc=$($('.role')[i]).find('.desc')[0].value;
		var Count = $($('.role')[i]).find('.count')[0].value;

		for(var k=0;k<Count;k++)
		{
			if(firstComma){
				firstComma=false;
			}else{query=query+", ";}
			query=query+"(NULL, '"+Title+"', '"+Desc+"', '0', '"+room+"') ";
		}
	}
	console.log(query);
	$.ajax({url:query,
			dataType:'json',
			success:function(result){
				console.log(result);
				window.location.assign('/Mafia/MafiaGodView.html?room='+room);
			}
	});

}

function newType(title,desc,count)
{
var tr='<tr class="role">';
var in1='<td><input class="title" type="text" value="'+title+'"></td>';
var in2='<td><input class="desc" type="text" value="'+desc+'"></td>';
var in3='<td><input class="count" type="number" value="'+count+'">';
var tre='</td></tr>';
$("#entry").append(tr+in1+in2+in3+tre);
}
findRoom();
newType("Mafia","Keep this a secret!",2);
newType("Villager","Try to find the Mafia!!",4);
</script>