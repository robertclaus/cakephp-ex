<div>This page allows players to play the party game Mafia without having to hand out cards.  The narrator/God player will create a new room.  There they can select what roles should be in play.  Once the room is created all other players select the correct Room ID and Enter the Room.  Each player will be assigned a role, and the host will see a list of all players and their roles.  This does not automate the game, but it allows assigning roles without needing to walk through who is in play.  It also avoids the first night since the narrator already knows who everyone is.</div>
</br></br></br>
<h2>Mafia</h2>
<div style="">
	<div style="float:left;width:100px;">Room ID:  </div>
	<div id="mafiaRoom" contentEditable="true" style="float:left;width:75px;height:30px;">abc</div>
	<div style="float:left;width:100px;">You're Name:  </div>
	<div id="mafiaName" contentEditable="true" style="float:left;width:75px;height:30px;"></div>
</div>
</br></br>
<button style='width:40%;height:70px;float:left' onclick="window.location.href='newMafiaRoom.html'">New Room</button>
<button style='width:40%;height:70px;' onclick="MafiaEnterRoom();">Enter Room</button>

</br></br>
</div>


<script src= "http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>
	window.onload = mafiaStartup();
	function mafiaStartup()
	{
		getLatestRoomID();
		getName();
	}
	function assignRandomName()
	{
		$.ajax({
  			url: 'https://randomuser.me/api/',
  			dataType: 'json',
  			success: function(data){
    				name=data.results[0].name.first;
				document.getElementById('mafiaName').innerHTML=name;
  			}
		});
	}
	function getName()
	{
		var name = getCookie("MafiaName");
		if(name=="")
		{
			assignRandomName();
		}
		else
		{
			document.getElementById('mafiaName').innerHTML=name;
		}
	}

	function getLatestRoomID()
	{
	var query = "../test3.php?query=SELECT%20MAX(Room)%20FROM%20MafiaSimple"
	$.ajax({url:query,
			dataType:'json',
			success:function(result){
				console.log(result);
				document.getElementById('mafiaRoom').innerHTML=result[0];
			}
		  });
	}

	function MafiaEnterRoom()
	{
		var room=document.getElementById('mafiaRoom').innerHTML;
		var name=document.getElementById('mafiaName').innerHTML;
		setCookie("MafiaName",name,120);
		window.location.href='newMafiaPlayer.html?room='+room+'&name='+name;
	}

	function setCookie(cname, cvalue, exdays) {
    		var d = new Date();
    		d.setTime(d.getTime() + (exdays*24*60*60*1000));
    		var expires = "expires="+d.toUTCString();
    		document.cookie = cname + "=" + cvalue + "; " + expires;
	}

	function getCookie(cname) {
    		var name = cname + "=";
    		var ca = document.cookie.split(';');
    		for(var i=0; i<ca.length; i++) {
        		var c = ca[i];
        		while (c.charAt(0)==' ') c = c.substring(1);
        		if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    		}
    		return "";
	}
</script>
